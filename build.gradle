plugins {
	id 'org.springframework.boot' version "${springBootVersion}"
	id 'io.spring.dependency-management' version "${dependencyManagementVersion}"
	id 'org.sonarqube' version '3.4.0.2513'
	id 'jacoco'
	id 'java'
}

description   = description
group         = group
version       = version

sourceCompatibility = '11'

apply from: 'dependencies.gradle'

configurations {
	compileOnly {
		extendsFrom annotationProcessor
	}
}

repositories {
	mavenCentral()
}

jacoco {
	toolVersion = "0.8.5"
}

jacocoTestReport {
    reports {
        xml.enabled true
		xml.destination file("$buildDir/jacoco/jacoco.xml")
        csv.enabled false
        html.enabled true
        html.destination file("$buildDir/reports/jacoco")
        
    }
}

jacocoTestCoverageVerification {
    violationRules {
        rule {
            enabled = true
            limit {
                counter = 'BRANCH'
                minimum = 0.80
            }
            excludes = []
        }

        rule {
            enabled = true
            limit {
                counter = 'METHOD'
                minimum = 0.80
            }
            excludes = []
        }
    }
}

sonarqube {
	properties {
		property "sonar.projectKey",  "mayconaraujosantos_mkdata-company"
		property "sonar.organization",  "mayconaraujosantos"
		property "sonar.host.url", "https://sonarcloud.io"
		property "sonar.coverage.jacoco.xmlReportPaths", "${rootProject.buildDir}/reports/jacoco/test/jacocoTestReport.xml"
	}
}
test {
	finalizedBy jacocoTestReport
}
tasks.named('test') {
	useJUnitPlatform()
}
